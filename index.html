<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head>
  <link rel="shortcut icon" href="./img/agoama.png" type="image/x-icon">
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=10; chrome=1;">
  <meta name="fragment" content="!">
  <!-- <base target="_blank"> -->
  <title>大家一起把回收拿給阿公阿嬤</title>
  <link href='css/style2.css' type='text/css' rel='stylesheet'>
  <link href='css/colorbox.css' type='text/css' rel='stylesheet'>
  <link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
  <link href='css/Leaflet.awesome-markers.css' type='text/css' rel='stylesheet'>

    <link href='https://docs.google.com/static/forms/client/css/212514800-mobile_formview_ltr.css' type='text/css' rel='stylesheet' media='screen and (max-device-width: 721px)'>
    <script src="//cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
    <script src="js/leaflet.awesome-markers.min.js"></script>
    <script type="text/javascript" src="js/tile.stamen.js"></script>
      <script type="text/javascript" src="js/h5f.js">
      </script>
      <!-- // <script src="js/pace.min.js"></script> -->
      <script src="js/tabletop.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
//  ga('create', 'UA-50648405-1', 'agoama.tw');
//  ga('require', 'displayfeatures');
//  ga('require', 'GTM-N8WW2GQ');
//  ga('send', 'pageview');

</script>
 <script type='text/javascript' src='js/jquery-1.10.2.min.js'></script>
    <script src="js/jquery.colorbox.js"></script>
             
      <link rel="alternate" type="text/xml+oembed" href="https://docs.google.com/forms/d/1x64IhdUPES5JXaL2pCh6mn0y-zKN6C7BksBUKdRXFa0/oembed?url=https://docs.google.com/forms/d/1x64IhdUPES5JXaL2pCh6mn0y-zKN6C7BksBUKdRXFa0/viewform&amp;format=xml">
      <meta name="viewport" content="width=device-width">
      <meta property="og:title" content="大家一起把回收拿給阿公阿嬤">
      <meta property="og:type" content="article">
      <meta property="og:site_name" content="幫阿公阿嬤做回收">
      <meta property="og:url" content="http://junsuwhy.github.io/whereisama/">
      <meta property="og:image" content="http://junsuwhy.github.io/whereisama/img/amabg.jpg">
      <meta property="og:image:width" content="400">
      <meta property="og:image:height" content="265">
      <meta property="og:description" content="你家附近有回收的阿公阿嬤嗎?
      請幫我們把他們的地址填入問卷
      我們將用這個資料，建立一個回收點地圖
      讓大家都可以把家裡的回收交給附近有在收回收的阿公阿嬤
      PS: 可以的話，盡可能取得阿公阿嬤公開資料的同意，避免造成他們的困擾。">
      <meta itemprop="name" content="大家一起把回收拿給阿公阿嬤">
      <meta itemprop="description" content="你家附近有回收的阿公阿嬤嗎? 請幫我們把他們的地址填入問卷 我們將用這個資料，建立一個回收點地圖，讓大家都可以把家裡的回收交給附近有在收回收的阿公阿嬤 PS:如果可以的話，盡可能取得阿公阿嬤公開資料的同意，避免造成他們的困擾">
      <meta itemprop="url" content="https://docs.google.com/forms/d/1x64IhdUPES5JXaL2pCh6mn0y-zKN6C7BksBUKdRXFa0/viewform">
      <meta itemprop="embedUrl" content="https://docs.google.com/forms/d/1x64IhdUPES5JXaL2pCh6mn0y-zKN6C7BksBUKdRXFa0/viewform?embedded=true">
      <meta itemprop="faviconUrl" content="http://junsuwhy.github.io/whereisama/img/agoama.png">
    </head>
    <body dir="ltr" class="ss-base-body">

      <div itemscope itemtype="http://schema.org/CreativeWork/FormObject">
      <div class="all-container">
        
        
        <script type="text/javascript">
          function click_handler(html){
            var jq = $(html);
            var tg = jq.attr("href");
            var state = { href: tg};
            history.pushState(state, document.title, state.href);
            $("html, body").animate({scrollTop:function(){return $(tg).position().top}()},700,"swing",function(){});
          }

        </script>
        <div class="header" >
           <img src="img/logo.png" alt=""/>
            <h1>把回收拿給阿公阿嬤</h1>
        </div>

<div class="info-wrapper menu-wrapper">
    <div class="info">
    <p>
     可曾見過那些辛苦推著大大小小回收物，令人鼻酸的背影嗎？<br>
     請大家幫幫忙！找出需要弱勢且關懷的拾荒長輩，並讓我們知道，<br>
     您的一個小動作，我們來替您提供關懷！<br>
     </p>
    <p>
        幫我們<a class="iframe register-agoama" href="javascript:void(0)">把他們的資料填入問卷</a><br>
     我們將前往訪查，並用這個資料，建立一個回收點地圖<br>
     讓大家都可以把家裡的回收附近有在收回收的阿公阿嬤
     </p>
     </div>
      <div class="menu">
          <ul>
              <li><a class="iframe register-agoama" href="javascript:void(0)">登記阿公阿嬤</a></li>
              
              
          </ul>
          <script>
$(function(){
    $('.iframe.register-agoama').colorbox({
        ifream: true,
        width: "90%",
        height: "90%",
        href: "http://docs.google.com/forms/d/e/1FAIpQLSeIViJYO6ComCrMglxwLMK8p4qCF5JJrU-vl8-Np5aiN5K4nw/viewform?embedded=true",
    });
})
          </script>
      </div>
</div>
<div id="map"><div class="load"><img src="img/loader.gif"/></div></div>
<div class="search-map-wrapper">
  <div class="search-map-div">
    <form class="search-map-form" action="javascript:void(0);">
                <input type="text" placeholder="你住哪兒?" name="search-map" class="ss-q-short" id="search-map-text" dir="auto">
  <input type="submit" name="submit" value="搜尋" id="search-map-submit">
</form>
              </div>
<script>
    cur_lat=0;
    cur_lng=0;
    cur_zoom=0;
    update_url = false;
    cur_agoama=-1;
    pre_para = location.href.match(/index\.html/g)?'index.html':'';

    $('.search-map-form').submit(function(){
      address = $('#search-map-text').val();
      ga('send', 'event', 'map', 'search', address);
      if(address !== ""){
        if(address == "doyouaflavor.tw"){
          map.addLayer(layer);
        }
        $.ajax({
          url: 'https://maps.googleapis.com/maps/api/geocode/json',
          //type: 'default GET (Other values: POST)',
          // dataType: 'json',
          data: {
            sensor  : false,
            address : address
          },
        })
        .done(function(data) {
          if(data.status=="OK"){
            //成功
            d = data;
            var nelat=data.results[0].geometry.viewport.northeast.lat;
            var nelng=data.results[0].geometry.viewport.northeast.lng;
            var swlat=data.results[0].geometry.viewport.southwest.lat;
            var swlng=data.results[0].geometry.viewport.southwest.lng;
            map.fitBounds([
              [nelat, nelng],
              [swlat, swlng]
            ]);
          }else{
            //失敗
            //d = data;
            //d.status=="ZERO_RESULTS";
            
          }
          
        })
        .fail(function() {
          //console.log("error");
        })
        .always(function() {
          //console.log("complete");
        });
        
      }
    })

  layer = new L.StamenTileLayer("watercolor");
  var map = L.map('map',{'scrollWheelZoom':false,}).setView([23.675,121.264], 7);
  mapLink =
    '<a href="http://openstreetmap.org">OpenStreetMap</a>';
  L.tileLayer(
    'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data &copy; ' + mapLink,
      maxZoom: 18,
    }).addTo(map);
  

  Tabletop.init({
    key: '1r8geMv62QiLS3rZFVSjn_q-nt_tfOqIxFmJOUP_OiH0',
    callback: afterLoadSheet,
    simpleSheet: false
  });

  
  function afterLoadSheet(data, tabletop) {

    try{
    //取得阿公阿嬤編號
    
    var url = location.href;
    var url_agoama = url.match(/agoama=[^&#]*/g)?parseInt(url.match(/agoama=[^&#]*/g)[0].split("=")[1]):null;
    if(url_agoama){
      cur_agoama = url_agoama;
    }
    var url_address = url.match(/address=([^&#]*)/g)?decodeURI(url.match(/address=[^&#]*/g)[0].split("=")[1]):null;
    var url_lat = url.match(/lat=[^&#]*/g)?parseFloat(url.match(/lat=[^&#]*/g)[0].split("=")[1]):null;
    var url_lng = url.match(/lng=[^&#]*/g)?parseFloat(url.match(/lng=[^&#]*/g)[0].split("=")[1]):null;
    var url_zoom = url.match(/zoom=[^&#]*/g)?parseInt(url.match(/zoom=[^&#]*/g)[0].split("=")[1]):null;
    

    var redMarker = L.AwesomeMarkers.icon({
        icon: 'star',
        markerColor: 'yellow'
      });




    // console.log(data);
    agoma_array = data.sheet1.elements;
    var arr_markers=[];

    for (var i = 0; i < agoma_array.length; i++) {
      /*
          回收時間-結束: "17:00"
          回收時間-開始: "09:00"
          回收項目: ""
          地址: "台灣台中市北區興進路218巷"
          性別: "女"
          意見回饋: ""
          時間戳記: "2014/5/10 下午 11:42:23"
          稱呼: "婆婆"
          經度: "120.6921969"
          緯度: "24.156139"
          附近地標: "湖南味小吃"
       */
      if(!isNaN(parseFloat(agoma_array[i]['緯度'])) && !isNaN(parseFloat(agoma_array[i]['經度']))){
        var name = add_tag(agoma_array[i]['稱呼'],"","h3");
        var address = add_tag(agoma_array[i]['地址']+'  <a href="https://www.google.com.tw/maps/place/'+agoma_array[i]['地址']+'" target="_blank" >到 Google 地圖</a>','地址',"div");
        var point = add_tag(agoma_array[i]['附近地標'],'附近地標',"div");
        var start = add_tag(agoma_array[i]['回收時間-開始'],'開始回收時間',"div");
        var end = add_tag(agoma_array[i]['回收時間-結束'],'結束回收時間',"div");
        var other = add_tag(break_line(agoma_array[i]['意見回饋']),'',"div","other");
        // var link_node ="";
        var link_node = add_tag('<a target="_self" href="./node.html?agoama='+i+'">補充資訊</a>','',"div");
        var text = name +address + point + start + end + other+link_node;

        arr_markers[i] = L.marker([agoma_array[i]['緯度'], agoma_array[i]['經度']]).addTo(map)
        .bindPopup(text);
        arr_markers[i].id=i;

        }
      }

      //處理完阿公阿嬤的點了
      
      //處理初始畫面
      if(url_agoama){
        arr_markers[url_agoama].openPopup();
      }

      if(url_address){
        $('#search-map-text').val(url_address);
        $('.search-map-form').submit();
      }else if(url_lat&&url_lng&&url_zoom){
        map.setView([url_lat,url_lng],url_zoom);
      }
      map_listen();


 }catch(e){
        console.log(e);
        is_error();

      }

      $('.load').hide('slow');
    };

    function break_line(text){
      return text.replace(/\n/g,"<br>");
    }

    function add_tag(val,name , htmltag, classname){
      name = (name == "")?"":name+ "：";
      myclass = (typeof classname == "undefined")? "": " class="+classname;
      return (val=="")?"":"<"+htmltag+myclass+">" + name + val + "</"+htmltag+">";
    }

    function map_listen(){
      //Map Event
      map.on('moveend',function(e){
        if(typeof ismoved=="undefined"){
          ga('send', 'event', 'map', 'move', 'move');
          ismoved = true;
        }
        set_url();
      })
      .on('zoomend',function(e){
        if(typeof iszoomed=="undefined"){
          ga('send', 'event', 'map', 'zoom', 'zoom');
          iszoomed = true;
        }
        set_url();
      })
      .on('popupopen',function(e){
        cur_agoama=e.popup._source.id;
        ga('send', 'event', 'map', 'popupopen', cur_agoama);
        set_url();
      })
      .on('popupclose',function(e){
        ga('send', 'event', 'map', 'popupclose', cur_agoama);
        cur_agoama = -1;
        set_url();
      });

    }

    function set_url(){
      cur_lat=map.getCenter().lat;
        cur_lng=map.getCenter().lng;
        cur_zoom=map.getZoom();
        new_para='?lat='+cur_lat+'&lng='+cur_lng+'&zoom='+cur_zoom+((cur_agoama!=-1)?('&agoama='+cur_agoama):'')+'#map';
        // $('.test').text('http://junsuwhy.github.io/whereisama/'+new_para);
        history.replaceState(null, document.title,pre_para+new_para);
    }


 function is_error(){
 
    }
</script>
      
      </div>
              <script type='text/javascript' src='https://docs.google.com/static/forms/client/js/3625253292-formviewer_prd.js'></script>
              
              
          

          </div>
          <!-- <div class="test"></div> -->
<div class="footer"><h2>關於我們</h2>

  <div class="footer-content">
    <div class="footer-logo1">
      <a target="_blank" onClick="ga('send', 'event', 'click', 'page', 'bottom');" href="http://doyouaflavor.tw/"><img src="img/logo-buttom-small.png" alt="" ></a>
    </div>
    <div class="footer-cross">
      <img src="img/cross.png" alt="">
    </div>
    <div class="ewca-mark">
    <a target="_blank" onClick="ga('send', 'event', 'click', 'website', 'bottom');" href="http://ewca.org.tw/"><img src="img/ewca-logo.png" alt="" ></a>
    </div>
  </div>


</div>
</div>
        </body></html>
